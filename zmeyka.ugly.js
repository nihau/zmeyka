function isInteger(e){return e===+e&&e===(0|e)}function getRandomInt(e,t){if(isInteger(e)){if(!isInteger(t))return getRandomInt(e,0);if(!(t>e)){var n=Math.random();return(n*(e-t)|0)+t}}}function isInteger(e){return e===+e&&e===(0|e)}var colorNameToHex=function(){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return function(t,n){return t===t+""?e[t]:n}}();Array.prototype.contains=function(e){return-1!==this.indexOf(e)},Array.prototype.first=function(e){return void 0===e?this[0]:("function"==typeof e&&e(this[0]),void(this[0]=e))},Array.prototype.last=function(e){return void 0===e?this[this.length-1]:("function"==typeof e&&e(this[this.length-1]),void(this[this.length-1]=e))},Array.prototype.remove=function(e){var t=this.indexOf(e);return 0>t&&this.splice(t,1),t},Array.prototype.removeAll=function(e){var t=-1;do t=this.remove(e);while(t>=0)},Array.prototype.clear=function(){this.Length=0};var Interval=function(e,t,n,o){if("function"!=typeof e)throw"invalid function";isInteger(t)||(t=1e3),isInteger(n)||(n=1),"boolean"!=typeof o&&(callinstatly=!1);var a,i=0,r=function(){0===i&&o===!0&&(i++,e()),n>i&&(i++,a=setTimeout(function(){e(),r()},t))};r(),this.stop=function(){clearTimeout(a)}},Point=function(e,t){this.x=e,this.y=t};Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.equalsTo=function(e){return this.x===e.x&&this.y===e.y};var CustomEvent=function(e){var t=[],n=this;this.subscribe=function(e){"function"==typeof e&&t.push(e)},this.unsubscribe=function(e){"function"==typeof e&&t.remove(e)},this.clearSubscribers=function(){t=[]},this.dispatch=function(e){for(var n=0;n<t.length;n++)t[n](e)},e instanceof CustomEvent&&e.subscribe(function(e){n.dispatch(e)})};CustomEvent.create=function(){return new customEvent};var c1=new CustomEvent;c1.subscribe(function(){console.log("1")});var c2=new CustomEvent;c2.subscribe(function(){console.log("2")}),c1.dispatch();var Notifyable=function(e){this.valueChanged=new CustomEvent,this.oldValue=void 0,this.value=e,this.setValue=function(e){this.oldValue=this.value,this.value=e,this.valueChanged.dispatch({oldValue:this.oldValue,newValue:this.value})},this.getValue=function(){return this.value}},GameObject=function(e){this.color=e+""===e?e:"black",this.onPickup=new CustomEvent};GameObject.prototype.consume=function(){this.onPickup.dispatch()};var Bonus=function(){GameObject.call(this,"blue")};Bonus.prototype=Object.create(GameObject.prototype);var voidObject=new GameObject("white");voidObject.prototype=Object.create(GameObject.prototype);var snakeHead=new GameObject("green");snakeHead.prototype=Object.create(GameObject.prototype);var snakeTail=new GameObject("red");snakeHead.prototype=Object.create(GameObject.prototype);var snake=function(){var e={},t=["left","up","right","down"],n=[],o=function(t){var o,r=n.last().clone();return i=a,r.x+=t.x,r.y+=t.y,r.x<0||r.x>=board.width||r.y<0||r.y>=board.height?gameLose():(o=n.first(),n.length===e.length&&n.shift(),n.push(r)),o},a="right",i=a;return e.moveEvent=new CustomEvent,e.length=3,e.changeDirection=function(e){return 2===Math.abs(t.indexOf(e)-t.indexOf(i))?void console.log("invalid move"):void(t.contains(e)&&(a=e+""))},e.move=function(){var e=new Point(0,0);switch(a){case"right":e.x=1;break;case"left":e.x=-1;break;case"up":e.y=-1;break;case"down":e.y=1;break;default:throw"what the fuck is wrong with direction?"}oldP=o(e),this.moveEvent.dispatch({newPoint:n.last(),oldPoint:oldP,body:n})},e.reset=function(){for(var e=this.length,t=0;e>t;t++)n[t]=new Point(t,0);this.direction="right"},e}(),boardWidth=25,boardHeight=25,board=function(e,t){var n=[];return n.height=t,n.width=e,n.clear=function(){for(var o=0;e>o;o++){n[o]=[];for(var a=0;t>a;a++)n[o][a]=voidObject}},n.clear(),n.invalidateEvent=new CustomEvent,n.getFreePoint=function(){var e=y=0;do e=getRandomInt(this.width),y=getRandomInt(this.height);while(n[e][y]!==voidObject);return new Point(e,y)},n.setObjectAtPoint=function(e,t){this.setObjectAtXY(e.x,e.y,t)},n.spawnAtRandomFree=function(e){var t=this.getFreePoint();n.setObjectAtPoint(t,e)},n.setObjectAtXY=function(e,t,o){n[e][t]=o,this.invalidateEvent.dispatch({x:e,y:t,gameObject:o})},n}(boardWidth,boardHeight),Model=function(){function e(){snake.move()}var t=.01,n=new Notifyable(0);this.newGameObject=new CustomEvent,this.invalidateEvent=new CustomEvent(board.invalidateEvent),this.scoreChanged=new CustomEvent(n.valueChanged);var o=function(){var e=void 0,t={};return t.placeBonus=function(){if(void 0===e){var t=new Bonus;e=t,board.spawnAtRandomFree(t),t.onPickup.subscribe(function(){n.setValue(n.getValue()+1),snake.length++,e=void 0,t.onPickup.clearSubscribers()})}},t}(),a=[],i={started:"START",stopped:"STOP",paused:"PAUSE"};i.stopped;this.gameStart=function(){n.setValue(0),board.clear(),snake.reset(),a.push(new Interval(e,1/t,9999,!0)),a.push(new Interval(o.placeBonus,1/t,9999,!0))},this.gameStop=function(){a.forEach(function(e){e.stop()}),a.clear()},this.gameRestart=function(){gameStop(),gameStart()},snake.moveEvent.subscribe(function(e){board.setObjectAtPoint(e.oldPoint,voidObject);for(var t=0;t<e.body.length-1;t++)board.setObjectAtPoint(e.body[t],snakeTail);var n=e.newPoint;board[n.x][n.y].consume(),board.setObjectAtPoint(n,snakeHead)}),snakeTail.onPickup.subscribe(function(){gameLose()})},View=function(e){var t=document.getElementById("myCanvas"),n=document.getElementById("score");t.height=300,t.width=300;var o=t.width/boardWidth,a=t.height/boardHeight,i=1,r=t.getContext("2d"),f=t.height/o,c=t.height/a;!function(){r.beginPath();for(var e=0;f>=e;e++)r.moveTo(e*o,0),r.lineTo(e*o,t.height);for(var n=0;c>=n;n++)r.moveTo(0,n*a),r.lineTo(t.width,n*a);r.stroke()}();var s=function(e,t,n){if(!(e>=f||0>e||t>=c||0>t)){n=(n||"white")+"";var s=i;r.fillStyle=colorNameToHex(n),r.fillRect(e*o+s,t*a+s,o-2*s,a-2*s)}};e.invalidateEvent.subscribe(function(e){s(e.x,e.y,e.gameObject.color)}),e.scoreChanged.subscribe(function(e){n.innerText=e.newValue})},Controller=function(e,t){function n(t){var n,o=t.keyCode|t.which;switch(o){case 13:e.gameStart();case 38:n="up";break;case 39:n="right";break;case 37:n="left";break;case 40:n="down";break;default:console.log(o)}void 0!==n&&snake.changeDirection(n)}document.body.onkeydown=n},MVC=function(e,t,n){"function"==typeof e&&"function"==typeof t&&"function"==typeof n&&(this.model=new e,this.view=new t(this.model),this.controller=new n(this.model,this.view))},mvc=new MVC(Model,View,Controller);mvc.model.gameStart();
